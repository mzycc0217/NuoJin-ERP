<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../Layui/layui-v2.5.6/layui/css/layui.css">
    <script src="../UrlModel/url.js"></script>
    <script src="../Layui/layui-v2.5.6/layui/layui.all.js"></script>
    <script src="../JS/jquery-3.4.1/jquery-3.4.1.js"></script>
    <script src="../Layui/layui-v2.5.6/layui/lay/modules/layer.js"></script>
    <script src="../Layui/layui-v2.5.6/layui/lay/modules/laydate.js"></script>
    <title>æˆå“å…¥åº“</title>
</head>

<body>
    <div class="layui-tab">
        <ul class="layui-tab-title">
            <li>æˆå“å…¥åº“</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item">

            </div>
        </div>
    </div>
    <table class="layui-hide" id="test4" lay-filter="test4"></table>
    <div class="site-text" style="margin: 5%; display: none" id="productBox4" target="test123">
        <form class="layui-form layui-form-pane" onsubmit="return false" id="productBook4" lay-filter="productt4">
            <div class="layui-form-item">
                <label class="layui-form-label">å¤‡æ³¨</label>
                <div class="layui-input-block">
                    <input id="productDes1" class="layui-input" /></br>
                </div>
                <label class="layui-form-label">ä»“åº“</label>
                <div class="layui-input-block">
                    <select id="productWarehouseId1"></select>
                </div>
            </div>
        </form>
    </div>
    <div class="site-text" style="margin: 5%; display: none" id="productBox5" target="test123">
        <form class="layui-form layui-form-pane" onsubmit="return false" id="productBook5" lay-filter="productt5">
            <div class="layui-form-item">
                <!-- <input type="hidden" id="leaderId"> -->
                <label class="layui-form-label">å¤‡æ³¨</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="productOverDes"><br>
                </div>
            </div>
        </form>
    </div>
    <script type="text/html" id="barDemo4">
        <a class="layui-btn layui-btn-xs" lay-event="edit4">å…¥åº“</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="over4">é©³å›</a>
    </script>
    <!--åºå·åˆ—-->
    <script type="text/html" id="xuHao">
        {{d.LAY_TABLE_INDEX+1}}
    </script>
    <!--ä¿¡æ¯-->
    <script type="text/html" id="buttonTpl">
        {{# if(d.Finshed_Sign == 1){ }}
        <button class="layui-btn layui-btn-warm layui-btn-xs">æˆå“</button> {{# } else if(d.Finshed_Sign == 2) { }}
        <button class="layui-btn  layui-btn-xs">åŠæˆå“</button> {{# } }}
    </script>
</body>
<script>
    window.onload = function() {
        anomation();
    }

    function productware(rawid) {
        $.ajax({
            type: 'POST',
            headers: {
                Authorization: window.header.Ae,
                UserId: window.header.Ud,
                AppFlag: window.header.Fg
            },
            url: window.url + "SaleProduct/BackSaleMonad", //åå°æ•°æ®åœ°å€
            data: {
                FishProductId: rawid,
            },
            success: function(data) {
                console.log('%c ğŸ¯ data: ', 'font-size:20px;background-color: #7F2B82;color:#fff;', data);
                $.each(data, function(index, item) { //å¾ªç¯åå°è¿”å›çš„jsonæ•°æ®
                    //new Optionæ–¹æ³•æ˜¯æ–°å»ºä¸€ä¸ªoptionï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦æ˜¾ç¤ºçš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯optionçš„valueå€¼,ç„¶åappendåˆ°ä¸‹æ‹‰æ¡†ä¸­ã€‚
                    $("#productWarehouseId1").append(new Option(item.entrepot.EntrepotName, item.EntrepotId));
                })
                layui.form.render('select');
            }
        });
    }
    layui.use(['laypage', 'layer', 'table', 'element', 'jquery', 'form'], function() {
        var laypage = layui.laypage //åˆ†é¡µ
            ,
            layer = layui.layer //å¼¹å±‚
            ,
            table = layui.table //è¡¨æ ¼
            ,
            element = layui.element //å…ƒç´ æ“ä½œ
            ,
            form = layui.form;

        table.render({
            elem: '#test4',
            height: 515,
            url: window.url + 'FinshedProductMonad/GetFinshedProductMonad' //æ•°æ®æ¥å£
                ,
            title: 'æ£€éªŒå…¥åº“',
            id: 'testReload4',
            toolbar: '#toolbarDemo4' //å¼€å¯å¤´éƒ¨å·¥å…·æ ï¼Œå¹¶ä¸ºå…¶ç»‘å®šå·¦ä¾§æ¨¡æ¿
                ,
            headers: {
                Authorization: window.header.Ae,
                UserId: window.header.Ud,
                AppFlag: window.header.Fg
            },
            method: 'post',
            page: true, //å¼€å¯åˆ†é¡µ
            limit: 10,

            cols: [
                [{
                    type: 'checkbox',
                    fixed: 'left'
                }, {
                    title: 'åºå·',
                    fixed: 'left',
                    templet: '#xuHao',
                }, {
                    field: 'z_FnishedProduct.Name',
                    title: 'äº§æˆå“',
                    fixed: 'left',
                    templet: function(res) {
                        if (res.z_FnishedProduct == null || res.z_FnishedProduct.Name == null) {
                            return "æ— "
                        } else {
                            return res.z_FnishedProduct.Name;
                        }
                    }
                }, {
                    field: 'z_FnishedProduct.Z_FinshedProductType.Name',
                    title: 'ç±»å‹',
                    fixed: 'left',
                    templet: function(res) {
                        if (res.z_FnishedProduct.Z_FinshedProductType == null || res.z_FnishedProduct.Z_FinshedProductType.Name == null) {
                            return "æ— "
                        } else {
                            return res.z_FnishedProduct.Z_FinshedProductType.Name;
                        }
                    }
                }, {
                    field: 'Finshed_Sign',
                    title: 'å‡ºå”®ç±»å‹',
                    fixed: 'left',
                    templet: '#buttonTpl',
                    minWidth: 150,
                    align: 'center'

                }, {
                    field: 'ApplyNumber',
                    title: 'å…¥åº“æ•°é‡',
                }, {
                    field: 'Company',
                    title: 'å•ä½',
                    templet: function(res) {
                        if (res.Company == null || res.Company.Name == null) {
                            return "æ— "
                        } else {
                            return res.Company.Name;
                        }
                    }
                }, {
                    field: 'Supplier',
                    title: 'ä¾›è´§å•†',
                    templet: function(res) {
                        if (res.Supplier == null || res.Supplier.Name == null) {
                            return "æ— "
                        } else {
                            return res.Supplier.Name;
                        }
                    }
                }, {
                    field: 'ApplyTime',
                    title: 'ç”³è¯·æ—¥æœŸ',
                    templet: function(res) {
                        return showTime(res.ApplyTime);
                    }
                }, {
                    fixed: 'right',
                    title: 'æ“ä½œ',
                    width: 240,
                    toolbar: '#barDemo4',
                }]
            ],
            request: {
                pageName: 'PageIndex' // é¡µç çš„å‚æ•°åç§°ï¼Œé»˜è®¤ï¼špage
                    ,
                limitName: 'PageSize' //æ¯é¡µæ•°æ®é‡çš„å‚æ•°åï¼Œé»˜è®¤ï¼šlimit
            },
            parseData: (res) => { //å°†åŸå§‹æ•°æ®è§£ææˆÂ tableÂ ç»„ä»¶æ‰€è§„å®šçš„æ•°æ®
                console.log('%c ğŸ» res: ', 'font-size:20px;background-color: #FFDD4D;color:#fff;', res);

                return {
                    "code": 0, //è§£ææ¥å£çŠ¶æ€
                    "msg": "æˆåŠŸ", //è§£ææç¤ºæ–‡æœ¬
                    "count": res.Count, //æ€»æ•°
                    data: res.data //è§£ææ•°æ®åˆ—è¡¨
                }
            }
        });

        //å¯»æ‰¾æ•°æ®
        $('.layui-btn').on('click', function() {
            var productName = $("#productName").val();
            //æ‰§è¡Œé‡è½½
            table.reload('testReload4', {
                page: {
                    curr: 1 //é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
                },
                where: {
                    Name: productName
                }
            }, 'data');
        });



        //ç›‘å¬è¡Œå·¥å…·äº‹ä»¶
        table.on('tool(test4)', function(obj) { //æ³¨ï¼štool æ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œtest æ˜¯ table åŸå§‹å®¹å™¨çš„å±æ€§ lay-filter="å¯¹åº”çš„å€¼"
            var data = obj.data //è·å¾—å½“å‰è¡Œæ•°æ®

            layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼
            console.log('%c ğŸ¡ data.FnishedProductId: ', 'font-size:20px;background-color: #ED9EC7;color:#fff;', data.FnishedProductId);
            productware(data.FnishedProductId);
            data.Id
            console.log('%c ğŸ¥˜ data.Id: ', 'font-size:20px;background-color: #FFDD4D;color:#fff;', data.Id);
            if (layEvent === 'edit4') {
                layer.open({
                    type: 1,
                    skin: 'layui-layer-molv',
                    area: ['400px', '300px'],
                    title: ['å…¥åº“', 'font-size:18px'],
                    btn: ['ç¡®å®š', 'å…³é—­'],
                    shadeClose: true,
                    shade: 0,
                    manmin: true,
                    content: $('#productBox4'),
                    yes: function(index, layero) {
                        $.ajax({
                            type: "POST",
                            url: window.url + "FinshedProductMonad/AddFinshedProductMonad",
                            headers: {
                                Authorization: window.header.Ae,
                                UserId: window.header.Ud,
                                AppFlag: window.header.Fg
                            },
                            contentType: "application/json",
                            data: JSON.stringify({
                                FinishProductId: data.Id,
                                ContentDes: $("#productDes1").val(),
                                enportid: $("#productWarehouseId1").val(),
                                user_Id: localStorage.getItem('UserId')
                            }),
                            success: function(res) {

                                table.reload('testReload4')
                                $("#productBox4").css("display", "none");
                                layer.close(index)
                            },
                            error: function(res) {
                                layer.msg(res);
                            }

                        })
                    },
                    btn2: function(layero) {
                        $("#productBox4").css("display", "none");
                    },
                    cancel: function() {
                        $("#productBox4").css("display", "none");
                    }
                });
                return false;
            } else if (layEvent === "over4") {
                layer.open({
                    type: 1,
                    skin: 'layui-layer-molv',
                    area: ['400px', '200px'],
                    title: ['å¤‡æ³¨', 'font-size:18px'],
                    btn: ['ç¡®å®š', 'å…³é—­'],
                    shadeClose: true,
                    shade: 0,
                    manmin: true,
                    content: $('#productBox5'),
                    yes: function(index, layero) {
                        $.ajax({
                            type: "POST",
                            url: window.url + "SaleProduct/SetRejectSaleMonad",
                            headers: {
                                Authorization: window.header.Ae,
                                UserId: window.header.Ud,
                                AppFlag: window.header.Fg
                            },
                            contentType: "application/json",
                            data: JSON.stringify({
                                Sale_Id: data.Id,
                                Des: $("#productOverDes").val(),
                            }),
                            success: function(res) {
                                console.log('%c ğŸ res: ', 'font-size:20px;background-color: #E41A6A;color:#fff;', res);
                                // table.reload('testReload4')
                                // $("#productBox5").css("display", "none");
                                // layer.close(index)
                            },
                            error: function(res) {
                                layer.msg(res);
                            }

                        })
                    },
                    btn2: function(layero) {
                        $("#productBox5").css("display", "none");
                    },
                    cancel: function() {
                        $("#productBox5").css("display", "none");
                    }
                });
                return false;
            }


        });
        //åˆ†é¡µ
        laypage.render({
            elem: 'pageDemo' //åˆ†é¡µå®¹å™¨çš„id
                ,
            count: 100 //æ€»é¡µæ•°
                ,
            skin: '#1E9FFF' //è‡ªå®šä¹‰é€‰ä¸­è‰²å€¼
                ,
            jump: function(obj, first) {
                if (!first) {
                    layer.msg('ç¬¬' + obj.curr + 'é¡µ', {
                        offset: 'b'
                    });
                }
            }
        });
    });
</script>

</html>