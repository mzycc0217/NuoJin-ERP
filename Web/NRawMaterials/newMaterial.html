<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../layui/layui.all.js"></script>
    <script src="../JS/jquery-3.4.1/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../JS/funtion.js"></script>
    <script src="../UrlModel/url.js"></script>
    <title>æ·»åŠ åŸææ–™ç”¨å“çš„ç±»åˆ«</title>
    <style>
        .mapHead {
            margin: 20px;
        }
        
        .layui-table-page select {
            height: 20px;
        }
    </style>
</head>

<body>
    <div class="mapWrap">
        <div class="mapHead">
            <div class="demoTable">
                æœç´¢åŸææ–™çš„åç§°ï¼š
                <div class="layui-inline">
                    <input class="layui-input" name="name" id="keyName" autocomplete="off" />
                </div>
                <button class="layui-btn" data-type="reload">æœç´¢</button>
            </div>
            <!--æ·»åŠ æ•°æ®-->
            <div class="site-text" style="margin: 5%; display: none" id="box1" target="test123">
                <form class="layui-form layui-form-pane" onsubmit="return false" id="book1" lay-filter="t1">
                    <div class="layui-form-item">
                        <label class="layui-form-label">åŸææ–™åç§°</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" id="rawName" /><br>
                        </div>
                        <label class="layui-form-label">åŸææ–™å¤‡æ³¨</label>
                        <div class="layui-input-block">
                            <input class="layui-input" id="rawDec" /><br>
                        </div>
                    </div>
                </form>
            </div>
            <!--ä¿®æ”¹-->
            <div class="site-text" style="margin: 5%; display: none" id="box3" target="test123">
                <form class="layui-form layui-form-pane" onsubmit="return false" id="book3" lay-filter="t3">
                    <div class="layui-form-item">
                        <input type="hidden" id="rawId">
                        <label class="layui-form-label">åŸææ–™åç§°</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input rawName" /><br>
                        </div>
                        <label class="layui-form-label">åŸææ–™å¤‡æ³¨</label>
                        <div class="layui-input-block">
                            <input class="layui-input rawDec" /><br>
                        </div>
                    </div>
                </form>
            </div>
            <!--è¯¦æƒ…-->
            <div class="site-text" style="margin: 5%; display: none" id="box2" target="test123">
                <form class="layui-form layui-form-pane" onsubmit="return false" id="book2" lay-filter="t2">
                    <div class="layui-form-item">
                        <input type="hidden" id="rawId1">
                        <label class="layui-form-label">åŸææ–™åç§°</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input rawName" onfocus="this.blur()" /><br>
                        </div>
                        <label class="layui-form-label">åŸææ–™å¤‡æ³¨</label>
                        <div class="layui-input-block">
                            <input class="layui-input rawDec" onfocus="this.blur()" /><br>
                        </div>
                    </div>
                </form>
            </div>
            <!--è¡¨æ ¼-->
            <table class="layui-hide" id="test" lay-filter="test"></table>
            <script type="text/html" id="toolbarDemo">
                <div class="layui-btn-container">
                    <button class="layui-btn layui-btn-sm" lay-event="add">æ·»åŠ </button>
                </div>
            </script>
            <script type="text/html" id="barDemo">
                <a class="layui-btn layui-btn-xs" lay-event="edit">ä¿®æ”¹</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>
            </script>
            <!--åºå·åˆ—-->
            <script type="text/html" id="xuHao">
                {{d.LAY_TABLE_INDEX+1}}
            </script>
        </div>
    </div>
</body>

</html>

<script>
 window.onload = function() {
            anomation();
        }
    //è¡¨
    layui.use(['laypage', 'layer', 'table', 'element', 'jquery', 'form'], function() {
        var laypage = layui.laypage //åˆ†é¡µ
            ,
            layer = layui.layer //å¼¹å±‚
            ,
            table = layui.table //è¡¨æ ¼
            ,
            element = layui.element //å…ƒç´ æ“ä½œ
            ,
            form = layui.form;

        table.render({
            elem: '#test',
            height: 515,
            url: window.url + 'RowType/GetRowType' //æ•°æ®æ¥å£
                ,
            title: 'åŸææ–™ç”¨å“è¡¨',
            id: 'testReload',
            toolbar: '#toolbarDemo' //å¼€å¯å¤´éƒ¨å·¥å…·æ ï¼Œå¹¶ä¸ºå…¶ç»‘å®šå·¦ä¾§æ¨¡æ¿
                ,
            headers: {
                Authorization: window.header.Ae,
                UserId: window.header.Ud,
                AppFlag: window.header.Fg
            },
            method: 'post',
            page: true, //å¼€å¯åˆ†é¡µ
            limit: 10,
            cols: [
                [{
                    type: 'checkbox',
                    fixed: 'left'
                }, {
                    title: 'åºå·',
                    fixed: 'left',
                    templet: '#xuHao',
                }, {
                    field: 'Name',
                    title: 'åŸææ–™ç”¨å“ç±»å‹åç§°',
                    fixed: 'left',
                }, {
                    field: 'Dec',
                    title: 'å¤‡æ³¨',
                }, {
                    fixed: 'right',
                    title: 'æ“ä½œ',
                    width: 240,
                    toolbar: '#barDemo',
                }]
            ],
            request: {
                pageName: 'PageIndex' // é¡µç çš„å‚æ•°åç§°ï¼Œé»˜è®¤ï¼špage
                    ,
                limitName: 'PageSize' //æ¯é¡µæ•°æ®é‡çš„å‚æ•°åï¼Œé»˜è®¤ï¼šlimit
            },
            parseData: (res) => { //å°†åŸå§‹æ•°æ®è§£ææˆÂ tableÂ ç»„ä»¶æ‰€è§„å®šçš„æ•°æ®
                console.log(res);
                return {
                    "code": 0, //è§£ææ¥å£çŠ¶æ€
                    "msg": "æˆåŠŸ", //è§£ææç¤ºæ–‡æœ¬
                    "count": res.Count, //æ€»æ•°
                    data: res.data //è§£ææ•°æ®åˆ—è¡¨
                }
            }
        });

        //å¯»æ‰¾æ•°æ®
        $('.layui-btn').on('click', function() {
            var keyName = $("#keyName").val();
            //æ‰§è¡Œé‡è½½
            table.reload('testReload', {
                page: {
                    curr: 1 //é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
                },
                where: {
                    Name: keyName
                }
            }, 'data');
        });

        //å¤´å·¥å…·æ äº‹ä»¶
        table.on('toolbar(test)', function(obj) {
            if (obj.event == "add") {
                layer.open({
                    type: 1,
                    skin: 'layui-layer-molv',
                    area: ['500px', '220px'],
                    title: ['æ·»åŠ ', 'font-size:18px'],
                    btn: ['ç¡®å®š', 'å…³é—­'],
                    shadeClose: true,
                    shade: 0,
                    manmin: true,
                    content: $('#box1'),
                    yes: function(index, layero) {
                        $.ajax({
                            type: "POST",
                            url: window.url + "RowType/AddRowType",
                            headers: {
                                Authorization: window.header.Ae,
                                UserId: window.header.Ud,
                                AppFlag: window.header.Fg
                            },
                            contentType: "application/json",
                            data: JSON.stringify({
                                Name: $("#rawName").val(),
                                Dec: $("#rawDec").val(),
                            }),
                            success: function(res) {
                                console.log('%c ğŸœ res: ', 'font-size:20px;background-color: #93C0A4;color:#fff;', res);
                                table.reload('testReload')
                                $("#box1").css("display", "none");
                                layer.close(index)
                            },
                            error: function(res) {
                                layer.msg(res);
                            }

                        })
                    },
                    btn2: function(layero) {
                        $("#box1").css("display", "none");
                    },
                    cancel: function() {
                        $("#box1").css("display", "none");
                    }
                });
                return false;
            }
        });
        //ç›‘å¬è¡Œçš„åŒå‡»äº‹ä»¶æ•°æ®è¯¦æƒ…
        table.on('rowDouble(test)', function(obj) {
            var data = obj.data;
            layer.open({
                type: 1,
                area: ['420px', '220px'],
                title: ['è¯¦æƒ…', 'font-size:18px'],
                shadeClose: true,
                shade: 0,
                manmin: true,
                content: $('#box2'),
                success: function(layero, index) {
                    $("#rawId1").val(data.Id),
                        $(".rawName").val(data.Name),
                        $(".rawDec").val(data.Dec)
                    layui.form.render();

                },
                cancel: function() {
                    $("#box2").css("display", "none");
                }
            });
        });
        //ç›‘å¬è¡Œå·¥å…·äº‹ä»¶
        table.on('tool(test)', function(obj) { //æ³¨ï¼štool æ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œtest æ˜¯ table åŸå§‹å®¹å™¨çš„å±æ€§ lay-filter="å¯¹åº”çš„å€¼"
            var data = obj.data //è·å¾—å½“å‰è¡Œæ•°æ®
            layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼
            var tr = obj.tr //è·å–å½“å‰è¡Œçš„trçš„DOMå¯¹è±¡
            if (layEvent === 'edit') {
                layer.open({
                    type: 1,
                    skin: 'layui-layer-molv',
                    area: ['400px', '220px'],
                    title: ['ä¿®æ”¹', 'font-size:18px'],
                    btn: ['ç¡®å®šä¿®æ”¹', 'å…³é—­'],
                    shadeClose: true,
                    shade: 0,
                    manmin: true,
                    content: $('#box3'),
                    success: function(layero, index) {
                        $("#rawId").val(data.Id),
                            $(".rawName").val(data.Name),
                            $(".rawDec").val(data.Dec)
                        layui.form.render();
                    },
                    yes: function(index, layero) {
                        $.ajax({
                            type: "POST",
                            url: window.url + "RowType/EditRowType",
                            headers: {
                                Authorization: window.header.Ae,
                                UserId: window.header.Ud,
                                AppFlag: window.header.Fg
                            },
                            contentType: "application/json",
                            data: JSON.stringify({
                                Id: $("#rawId").val(),
                                Name: $(".rawName").val(),
                                Dec: $('.rawDec').val(),
                            }),
                            success: function(res) {
                                table.reload('testReload')
                                $("#box3").css("display", "none");
                                layer.close(index)
                            },
                            error: function(res) {
                                layer.msg(res);
                            }

                        })
                    },
                    btn2: function(layero) {
                        $("#box3").css("display", "none");
                    },
                    cancel: function() {
                        $("#box3").css("display", "none");
                    }
                });
                return false;
            } else if (layEvent === 'del') {
                var wareArr = [];
                wareArr.push(data.Id);
                console.log(data.Id)
                layer.confirm('çœŸçš„åˆ é™¤è¡Œä¹ˆ', function(index) {
                    //å‘æœåŠ¡ç«¯å‘é€åˆ é™¤æŒ‡ä»¤
                    $.ajax({
                        type: "POST",
                        url: window.url + "RowType/RemoveRowType",
                        headers: {
                            Authorization: window.header.Ae,
                            UserId: window.header.Ud,
                            AppFlag: window.header.Fg
                        },
                        contentType: "application/json",
                        data: JSON.stringify({
                            del_Id: wareArr,
                        }),
                        success: function(res) {
                            table.reload('testReload')
                            layer.close(index)
                        },
                        error: function(res) {
                            layer.msg(res);
                        }
                    })
                });
            }
        });
        //åˆ†é¡µ
        laypage.render({
            elem: 'pageDemo' //åˆ†é¡µå®¹å™¨çš„id
                ,
            count: 100 //æ€»é¡µæ•°
                ,
            skin: '#1E9FFF' //è‡ªå®šä¹‰é€‰ä¸­è‰²å€¼
                ,
            jump: function(obj, first) {
                if (!first) {
                    layer.msg('ç¬¬' + obj.curr + 'é¡µ', {
                        offset: 'b'
                    });
                }
            }
        });
    });
</script>